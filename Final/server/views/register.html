<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>注册</title>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link type="text/css" rel="stylesheet" href="/materialize/css/materialize.min.css" media="screen,projection"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>
<div class="container">
	<div class="section">
		<div class="row">
			<div class="col s12 l6">
				<h2 class="title">Welcome</h2>
				<div class="content">
					<h5>Welcome to join us!</h5>
				</div>
			</div>
			<div class="col s12 l6">
				<form class="card-panel " action="register" method="post">
					<div class="row">
						<div class="input-field col s12">
							<input id="username" type="text" class="validate" name="username" onblur="isExisted()">
							<label id="usernameLab" for="username">用户名</label>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s12">
							<input id="password" type="password" class="validate" name="pwd">
							<label for="password">密码</label>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s12">
							<input id="passwordC" type="password" class="validate" name="pwdC">
							<label for="passwordC">重复密码</label>
						</div>
					</div>
					<div class="row center-align">
						<div class="input-field col s12">
							<input value="注册" type="submit" class="waves-effect waves-light btn-small">
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript" src="/materialize/js/materialize.min.js"></script>
<script>
	function isExisted() {
		let usernameObj = document.getElementById('username');
		let usernameLab = document.getElementById('usernameLab');
		let username = usernameObj.value;
		console.log(username);
		fetch('/isExisted', {
			method: "POST",
			headers : {
				'Content-Type': 'application/json',
				'Accept': 'application/json'
			},
			body: JSON.stringify({
				username: username
			}),
			redirect: "follow",
		}).then(response => {
			if (response.status === 200) {
				return response.json();
			}
		}).then(json => {
			if (json.code === 221) {
				usernameLab.innerText = 'test';
			}
		}).catch(error => {
			console.log(error);
		});
	}
</script>
</body>
</html>