<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
</head>
<body>
<div class="welcome">

</div>
<script>
	function getck(sname) {//获取单个cookies
		var acookie = document.cookie.split("; ");
		console.log(acookie);
		for (var i = 0; i < acookie.length; i++) {
			var arr = acookie[i].split("=");
			if (sname == arr[0]) {
				if (arr.length > 1)
					return unescape(arr[1]);
				else
					return "";
			}
		}
		return "";
	}

	var user = getck('user');
	console.log(user);

	if (user != null && user != "") {
		var username = JSON.parse(user.slice(2)).username;
		document.getElementsByClassName('welcome').item(0).innerHTML = "<p>Welcome! " + username + "</p><button id='logout'>Logout</button>";

		btnLogout = document.getElementById('logout').onclick = function () {
			console.log('clicked');
			fetch('/logout', {method: 'get', redirect: "follow", credentials: "include"})
			.then(res => {
				if (res.status == 200)
					window.location.reload();
			})
			// .then(text => {
			// 	console.log(text);
			// 	window.location.href = text;
			// })
			.catch(error => {
				console.log(error);
			});
		}
	}
	else {
		document.getElementsByClassName('welcome').item(0).innerHTML = "<p>Hello</p><button id='login'>Login</button>";
		btnLogin = document.getElementById('login').onclick = function () {
			console.log('clicked');
			window.location.href = '/login';
			// fetch('/login', {method: 'get'})
			// .then(res => {
			// 	if (res.status == 200)
			// 		return res.text();
			// })
			// .then(text => {
			// 	console.log(text);
			// 	window.location.href = text;
			// })
			// 	.catch(error => {
			// 		console.log(error);
			// 	});
		}
	}

</script>
</body>
</html>